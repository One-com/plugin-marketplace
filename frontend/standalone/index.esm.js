/*! For license information please see index.esm.js.LICENSE.txt */
import*as e from"react-dom";import*as t from"react";var a={20:(e,t,a)=>{var n=a(649),l=Symbol.for("react.element"),s=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),o=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,r={key:!0,ref:!0,__self:!0,__source:!0};function i(e,t,a){var n,i={},c=null,d=null;for(n in void 0!==a&&(c=""+a),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(d=t.ref),t)s.call(t,n)&&!r.hasOwnProperty(n)&&(i[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===i[n]&&(i[n]=t[n]);return{$$typeof:l,type:e,key:c,ref:d,props:i,_owner:o.current}}t.jsx=i,t.jsxs=i},338:(e,t,a)=>{var n=a(516);t.H=n.createRoot,n.hydrateRoot},516:t=>{t.exports=e},649:e=>{e.exports=t},848:(e,t,a)=>{e.exports=a(20)}},n={};function l(e){var t=n[e];if(void 0!==t)return t.exports;var s=n[e]={exports:{}};return a[e](s,s.exports,l),s.exports}l.d=(e,t)=>{for(var a in t)l.o(t,a)&&!l.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var s=l(649),o=l(338),r=l(848);function i(e){let{plugin:t,pluginInAction:a,onAction:n}=e;const l=e=>{n(e,t)};return(0,r.jsx)("div",{className:"plugin-actions gv-card-content gv-flex gv-gap-sm gv-mt-md",children:t.installed?t.activated?(0,r.jsx)("button",{className:"gv-button gv-button-secondary",disabled:a[t.slug],onClick:()=>l("deactivate"),children:a[t.slug]?marketplaceConfig.labels.deactivating:marketplaceConfig.labels.deactivate}):(0,r.jsx)("button",{className:"gv-button gv-button-primary",disabled:a[t.slug],onClick:()=>l("activate"),children:a[t.slug]?marketplaceConfig.labels.activating:marketplaceConfig.labels.activate}):(0,r.jsx)("button",{className:"gv-button gv-button-secondary",disabled:a[t.slug],onClick:()=>l("install"),children:a[t.slug]?marketplaceConfig.labels.installing:marketplaceConfig.labels.install})})}function c(e){let{apiBaseUrl:t,useWPHandlers:a,wpConfig:n,enableDefaultStyles:l}=e;const[o,c]=(0,s.useState)([]),[d,u]=(0,s.useState)(!0),[g,p]=(0,s.useState)({});(0,s.useEffect)(()=>{!async function(){try{const a=await fetch(`${t}`),n=(e=await a.json())&&e.data?.ui_json?e.data.ui_json.map(e=>({...e,name:e.name||"Unknown",slug:e.slug||"",price:e.price||"",author:e.author||"",version:e.version||"",download:e.download||"",thumbnail:e.thumbnail||"",description:"object"==typeof e.description?e.description["en-gb"]||Object.values(e.description)[0]||"":e.description||"",installed:e.installed??!1,activated:e.activated??!1})):[];c(n)}catch(e){console.error("Failed to fetch plugins",e)}finally{u(!1)}var e}()},[t,a,n]);const v=async(e,l)=>{p(e=>({...e,[l.slug]:!0}));try{let s=`${t}/${e}/${l.slug}`;const o=`download_url=${encodeURIComponent(l.download||"")}`;s=a?`${n.ajax_url}?action=marketplace_${e}_plugin&_wpnonce=${n.nonce}&slug=${l.slug}&${o}`:s+(s.includes("?")?"&":"?")+o;const r=await fetch(s,{method:"POST"}),i=await r.json();i.success?c(e=>e.map(e=>e.slug===l.slug?{...e,installed:i.data.installed,activated:i.data.activated}:e)):alert(i.data?.message||"Failed to perform action")}catch(e){console.error("Plugin action failed",e)}finally{p(e=>({...e,[l.slug]:!1}))}};return d?(0,r.jsx)("p",{children:"Loading plugins..."}):(0,r.jsx)("div",{className:"marketplace gv-grid gv-gap-lg gv-tab-grid-cols-1 gv-desk-grid-cols-2 gv-mt-md",children:o.map(e=>(0,r.jsxs)("div",{id:`plugin-${e.slug}`,className:"gv-card oc-plugins-box gv-surface-bright gv-pb-lg",children:[(0,r.jsx)("div",{className:"gv-card-illustration",children:(0,r.jsx)("img",{className:"gv-tile",src:e.thumbnail,alt:e.name,width:"72",height:"72"})}),(0,r.jsxs)("div",{className:"gv-card-content",children:[(0,r.jsx)("h3",{className:"gv-card-title",children:e.name}),(0,r.jsxs)("p",{children:[e.description?e.description:e.shortDescription,"   "]})]},e.slug),!0===a&&(0,r.jsx)(i,{plugin:e,pluginInAction:g,onAction:v})]}))})}const d=e=>{let{apiBaseUrl:t,useWPHandlers:a,wpConfig:n,enableDefaultStyles:l}=e;return(0,r.jsxs)("div",{className:"marketplace-container gv-p-lg",children:[(0,r.jsx)("h2",{children:"Available Plugins"}),(0,r.jsx)(c,{apiBaseUrl:t,useWPHandlers:a,wpConfig:n,enableDefaultStyles:l})]})};function u(e){const t=document.querySelector(e.selector||"#marketplace-root");t&&(0,o.H)(t).render((0,r.jsx)(d,{...e}))}document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("marketplace-root");if(e){const t=window.marketplaceConfig||{};(0,o.H)(e).render((0,r.jsx)(d,{...t}))}});const g=d;export{g as default,u as initMarketplaceApp};